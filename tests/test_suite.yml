tests:
  - name: volume_modern_2LYZ
    description: Verify modern Volume.exe output for 2LYZ at probe 2.1 / grid 0.9
    workdir: volume_results/2LYZ
    prerequisites:
      - action: download_pdb
        pdb_id: 2LYZ
        dest: 2LYZ.pdb
    program: Volume.exe
    args:
      - -i 2LYZ.pdb
      - --exclude-ions
      - --exclude-water
      - -p 2.1
      - -g 0.9
      - -o 2LYZ-volume-suite.pdb
      - -m 2LYZ-volume-suite.mrc
    expect:
      summary:
        volume: 18550.861
        surface: 4982.054
        atoms: 1001
      pdb:
        path: 2LYZ-volume-suite.pdb
        lines: 4886
        hetatm_lines: 4870
        hetatm_md5: d8611307bbcc68315bd10d1a7f1f3741

  - name: volume_pdb_input_2LYZ
    description: Ensure Volume.exe accepts raw PDB input and matches XYZR results for 2LYZ.
    workdir: volume_results/2LYZ
    prerequisites:
      - action: download_pdb
        pdb_id: 2LYZ
        dest: 2LYZ.pdb
      - action: remove
        path: 2LYZ-volume-pdb-suite.pdb
    program: Volume.exe
    args:
      - -i 2LYZ.pdb
      - -p 2.1
      - -g 0.9
      - --exclude-ions
      - --exclude-water
      - -o 2LYZ-volume-pdb-suite.pdb
    expect:
      summary:
        volume: 18550.861
        surface: 4982.054
        atoms: 1001
      pdb:
        path: 2LYZ-volume-pdb-suite.pdb
        lines: 4884
        hetatm_lines: 4870
        hetatm_md5: d8611307bbcc68315bd10d1a7f1f3741

  - name: find_channel_seed_2LYZ
    description: Ensure Channel.exe handles an empty seed on 2LYZ
    workdir: volume_results/2LYZ
    prerequisites:
      - action: download_pdb
        pdb_id: 2LYZ
        dest: 2LYZ.pdb
    program: Channel.exe
    args:
      - -i 2LYZ.pdb
      - --exclude-ions
      - --exclude-water
      - -b 2.5
      - -s 1.5
      - -t 2.0
      - -g 0.9
      - -x -10
      - -y 5
      - -z 0
      - -o 2LYZ-channel-suite.pdb
    expect:
      stdout_contains: "Accessible Channel Volume"
      pdb:
        path: 2LYZ-channel-suite.pdb
        lines: 24
        hetatm_lines: 0
        hetatm_md5: d41d8cd98f00b204e9800998ecf8427e

  - name: cavities_modern_2LYZ
    description: Run Cavities.exe on 2LYZ to ensure zero cavities produce the expected header-only PDB.
    workdir: volume_results/2LYZ
    prerequisites:
      - action: download_pdb
        pdb_id: 2LYZ
        dest: 2LYZ.pdb
      - action: remove
        path: 2LYZ-cavities-suite.pdb
    program: Cavities.exe
    args:
      - -i 2LYZ.pdb
      - --exclude-ions
      - --exclude-water
      - -b 10
      - -s 3
      - -t 3
      - -g 0.9
      - -o 2LYZ-cavities-suite.pdb
    expect:
      stdout_contains: "CAVITY VOLUME"
      pdb:
        path: 2LYZ-cavities-suite.pdb

  - name: volume_fill_cavities_modern_2LYZ
    description: Run VolumeNoCav.exe and ensure output matches Volume.exe baseline.
    workdir: volume_results/2LYZ
    prerequisites:
      - action: download_pdb
        pdb_id: 2LYZ
        dest: 2LYZ.pdb
      - action: remove
        path: 2LYZ-volnocav-suite.pdb
    program: VolumeNoCav.exe
    args:
      - -i 2LYZ.pdb
      - --exclude-ions
      - --exclude-water
      - -p 2.1
      - -g 0.9
      - -o 2LYZ-volnocav-suite.pdb
    expect:
      pdb:
        path: 2LYZ-volnocav-suite.pdb
        lines: 4884
        hetatm_lines: 4870
        hetatm_md5: d8611307bbcc68315bd10d1a7f1f3741

  - name: volume_modern_1BL8
    description: Verify Volume.exe output for potassium channel 1BL8 at probe 1.0 / grid 0.9.
    workdir: volume_results/1BL8
    prerequisites:
      - action: download_pdb
        pdb_id: 1BL8
        dest: 1BL8.pdb
    program: Volume.exe
    args:
      - -i 1BL8.pdb
      - --exclude-ions
      - --exclude-water
      - -p 1.0
      - -g 0.9
      - -o 1BL8-volume-suite.pdb
    expect:
      summary:
        volume: 50426.382
        surface: 16796.623
        atoms: 2820
      pdb:
        path: 1BL8-volume-suite.pdb
        lines: 16038
        hetatm_lines: 16024
        hetatm_md5: 0c6437fef0abdd82f3dc3cd2fc08675a

  - name: volume_fill_cavities_modern_1BL8
    description: Ensure VolumeNoCav.exe fills 1BL8 cavities when using probe 1.0 / grid 0.9.
    workdir: volume_results/1BL8
    prerequisites:
      - action: download_pdb
        pdb_id: 1BL8
        dest: 1BL8.pdb
    program: VolumeNoCav.exe
    args:
      - -i 1BL8.pdb
      - --exclude-ions
      - --exclude-water
      - -p 1.0
      - -g 0.9
      - -o 1BL8-volnocav-suite.pdb
    expect:
      pdb:
        path: 1BL8-volnocav-suite.pdb
        lines: 15107
        hetatm_lines: 15093
        hetatm_md5: 881f7af2b8bffa64d806d4979bd84eaf

  - name: vdw_modern_2LYZ
    description: Validate VDW.exe van-der-Waals output on 2LYZ with 0 probe / 0.9 grid.
    workdir: volume_results/2LYZ
    prerequisites:
      - action: download_pdb
        pdb_id: 2LYZ
        dest: 2LYZ.pdb
      - action: remove
        path: 2LYZ-vdw-suite.pdb
    program: VDW.exe
    args:
      - -i 2LYZ.pdb
      - --exclude-ions
      - --exclude-water
      - -g 0.9
      - -o 2LYZ-vdw-suite.pdb
    expect:
      pdb:
        path: 2LYZ-vdw-suite.pdb
        lines: 10285
        hetatm_lines: 10273
        hetatm_md5: f661021b75e026cf47a19948234f9d51

  - name: solvent_modern_1BL8
    description: Ensure Solvent.exe captures external solvent for 1BL8 using mixed probes.
    workdir: volume_results/1BL8
    prerequisites:
      - action: download_pdb
        pdb_id: 1BL8
        dest: 1BL8.pdb
      - action: remove
        path: 1BL8-solvent-suite.pdb
    program: Solvent.exe
    args:
      - -i 1BL8.pdb
      - --exclude-ions
      - --exclude-water
      - -s 1.5
      - -b 5.0
      - -t 2.0
      - -g 0.9
      - -o 1BL8-solvent-suite.pdb
    expect:
      stdout_contains: "Accessible Channel Volume"
      pdb:
        path: 1BL8-solvent-suite.pdb
        lines: 2361
        hetatm_lines: 2343
        hetatm_md5: d9723facba8a991dd7deabb5e2c69a05

  - name: all_channel_accessible_1BL8
    description: Detect potassium-channel paths from 1BL8 with AllChannel.exe.
    workdir: volume_results/1BL8
    prerequisites:
      - action: download_pdb
        pdb_id: 1BL8
        dest: 1BL8.pdb
      - action: remove
        path: channel-001.mrc
      - action: remove
        path: channel-002.mrc
      - action: remove
        path: channel-003.mrc
      - action: remove
        path: channel-004.mrc
      - action: remove
        path: channel-005.mrc
    program: AllChannel.exe
    args:
      - -i 1BL8.pdb
      - --exclude-ions
      - --exclude-water
      - -b 5.0
      - -s 1.0
      - -g 0.8
      - -t 2.0
      - -v 20
      - -p 0.0
      - -n 5
    expect:
      stdout_contains: "Used 5 of 94 channels"

  - name: all_channel_excluded_1BL8
    description: Run AllChannelExc.exe with strict cutoffs to ensure only the central pore remains.
    workdir: volume_results/1BL8
    prerequisites:
      - action: download_pdb
        pdb_id: 1BL8
        dest: 1BL8.pdb
      - action: remove
        path: 1BL8-allchannelexc-suite.mrc
      - action: remove
        path: channel-001.mrc
      - action: remove
        path: channel-002.mrc
      - action: remove
        path: channel-003.mrc
      - action: remove
        path: channel-004.mrc
      - action: remove
        path: channel-005.mrc
    program: AllChannelExc.exe
    args:
      - -i 1BL8.pdb
      - --exclude-ions
      - --exclude-water
      - -b 5.0
      - -s 1.0
      - -g 0.8
      - -t 2.0
      - -v 20
      - -p 0.01
      - -m 1BL8-allchannelexc-suite.mrc
    expect:
      stdout_contains: "Used 1 of 63 channels"
